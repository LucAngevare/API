const express = require('express');
const app = module.exports = express()

app.post('/vulnerabilityChecker', function(req, res) {
	link = req.body.link;
	xssChecker = req.body.XSS;
	href = url.parse(link);
  vulnerabilites = 0;
	/*var session = ping.createSession();
	session.pingHost(target, function(error, target) {
		if (error) console.log(target + ": " + error.toString());
		isAlive = true;
	});*/

	//if (href) {
		request(link, function(error, response, body) {
			if (error) {
				console.log(error)
			} else {
				vulnerabilities += body.match(/\<script\>/g).length
				if (!body.toString().toLowerCase().trim().includes("privacypolicy")) {
					vulnerabilities += 2;
				}

				if (body.includes("window.location.href =")) {
					vulnerabilities += 10;
				}
			}
		})
	  res.send(`Amount of vulnerabilites found: ${vulnerabilities}`)
	})